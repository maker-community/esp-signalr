menu "ESP32 SignalR Client Configuration"

    config SIGNALR_WORKER_POOL_SIZE
        int "Worker thread pool size"
        default 2
        range 1 5
        help
            Number of worker threads in the SignalR scheduler pool.
            Smaller values save memory but may reduce concurrent callback handling.
            Default: 2 (optimized for ESP32)
            
    config SIGNALR_WORKER_STACK_SIZE
        int "Worker task stack size (bytes)"
        default 6144
        range 2048 8192
        help
            Stack size for each worker task in bytes.
            CRITICAL: C++ exception handling requires minimum 4-5KB stack!
            Default: 6144 (6KB) - required for safe exception unwinding
            Old default 3KB caused stack overflow during send() failures with exceptions.
            DO NOT reduce below 4096 unless you disable all exception throwing.
            Enable CONFIG_SIGNALR_ENABLE_STACK_MONITORING to measure actual usage.
            
    config SIGNALR_SCHEDULER_STACK_SIZE
        int "Scheduler task stack size (bytes)"
        default 6144
        range 4096 16384
        help
            Stack size for the scheduler task in bytes.
            Default: 6144 (6KB, optimized for ESP32)
            Recommended: Keep at 6KB unless stack monitoring shows otherwise.
            Enable CONFIG_SIGNALR_ENABLE_STACK_MONITORING to measure actual usage.
            
    config SIGNALR_CALLBACK_STACK_SIZE
        int "WebSocket callback task stack size (bytes)"
        default 6144
        range 4096 32768
        help
            Stack size for the WebSocket callback processing task.
            Default: 6144 (6KB, reduced from 32KB for memory efficiency)
            Recommended: 6KB for typical SignalR usage, 8KB for complex JSON processing
            Increase if you experience stack overflow in callbacks.
            Enable CONFIG_SIGNALR_ENABLE_STACK_MONITORING to measure actual usage.
            
    config SIGNALR_MAX_MESSAGE_SIZE
        int "Maximum message size (bytes)"
        default 4096
        range 1024 16384
        help
            Maximum size of a single SignalR message.
            Default: 4096 (4KB)
            
    config SIGNALR_CONNECTION_TIMEOUT_MS
        int "Connection timeout (milliseconds)"
        default 10000
        range 5000 60000
        help
            Timeout for establishing WebSocket connection.
            Default: 10000 (10 seconds)
            
    config SIGNALR_ENABLE_DETAILED_LOGS
        bool "Enable detailed logging"
        default n
        help
            Enable detailed debug logging for SignalR operations.
            Useful for debugging but increases code size and runtime overhead.
            
    config SIGNALR_ENABLE_TRACE_LOG_WRITER
        bool "Enable trace log writer (std::clog output)"
        default n
        help
            Enable trace_log_writer which outputs to std::clog.
            Disable to save ~1KB of code size.
            Note: ESP32 logging via ESP_LOG is always available.
            
    config SIGNALR_SKIP_NEGOTIATION
        bool "Skip negotiation phase (direct WebSocket)"
        default n
        help
            Skip the HTTP negotiation phase and connect directly via WebSocket.
            Only enable if your SignalR server supports this mode.
            Saves memory and connection time.
            
    config SIGNALR_ENABLE_NEGOTIATION
        bool "Enable HTTP negotiation support"
        default y
        help
            Enable HTTP negotiation phase support.
            Disable if you always use skip_negotiation mode.
            Saves ~2KB by excluding negotiate.cpp and reducing HTTP client usage.
            
    config SIGNALR_MAX_QUEUE_SIZE
        int "Maximum message queue size"
        default 50
        range 10 200
        help
            Maximum number of messages that can be queued before dropping oldest messages.
            Prevents memory leak if message processing is slower than message arrival rate.
            Default: 50 messages
            Recommendation: Set based on your message rate and processing speed.
            
    config SIGNALR_ENABLE_STACK_MONITORING
        bool "Enable stack usage monitoring"
        default n
        help
            Enable stack high water mark monitoring for scheduler and callback tasks.
            Logs stack usage at task start/end to help optimize stack sizes.
            Adds minimal runtime overhead (~100 bytes RAM, negligible CPU).
            Useful for development and optimization, disable in production.

endmenu
